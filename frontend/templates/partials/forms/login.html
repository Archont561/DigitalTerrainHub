{% load widget_tweaks %}

<form 
    id="login-form"
    hx-post="{% url 'user:login' %}" 
    hx-target="#login-form" 
    hx-swap="outerHTML"
    data-show-loader
>
    {% csrf_token %}
    {% for field in form %}
        <div class="mb-4">
            <label 
                class="font-semibold text-sm text-gray-600 pb-1 block" 
                for="{{ field.id_for_label }}"
            >{{ field.label }}</label>
           
            {{ field|add_class:"border rounded-lg px-3 py-2 mt-1 mb-5 text-sm w-full" }}

            {% if field.errors %}
                <ul>
                    {% for error in field.errors %}
                        <li class="break-words">{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endfor %}
    {% if form.non_field_errors %}
        <dialog 
            x-data="{ isShaking: false }"
            x-init="$el.showModal()"
            x-bind:class="{ 'animate-shake': isShaking }"
            @click.self="isShaking = true; setTimeout(() => { isShaking = false; }, 500);"
            class="p-0 bg-white rounded-3xl shadow-xl w-3/4 md:w-1/2 lg:w-2/5"
        >
            <div class="w-full p-4">
                <h2 class="text-red-600 font-semibold text-4xl text-center mb-4">Form Error</h2>
                <ul class="space-y-2 text-left text-red-700">
                    {% for error in form.non_field_errors %}
                        <li class="whitespace-pre-wrap">{{ error }}</li>
                    {% endfor %}
                </ul>
                <div class="mt-6 text-right">
                    <button
                        @click="
                            isVisible = false;
                            setTimeout(() => $el.close(), 300);
                        "
                        class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200"
                    >OK</button>
                </div>
            <div>
        </dialog>
    {% endif %}
    <button 
        type="submit" 
        class="transition duration-200 bg-blue-500 hover:bg-blue-600 focus:bg-blue-700 focus:shadow-sm focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 text-white w-full py-2.5 rounded-full text-sm shadow-sm hover:shadow-md font-semibold text-center inline-block"
    >
        Login
    </button>
</form>