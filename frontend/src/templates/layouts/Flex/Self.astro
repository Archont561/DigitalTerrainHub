---
import type { ComponentProps } from "astro/types";
import type { FlexProps } from "./types";
import Layout from "@layouts";
import { createStylesheetHTML } from "./utils";
import { clsx as mergeCSSClasses } from "clsx";

type Props = FlexProps & Astro.ComponentProps & ComponentProps<typeof Layout.Melt>;

const { placement, multilinePlacement, inline, gap, direction, ...props } = Astro.props;

const flexUUID = crypto.randomUUID();

Object.assign(props, {
    [flexUUID]: "",
    class: mergeCSSClasses(
        "astro-flex",
        { "inline": inline },
        props?.class,
    ),
})
---

<Layout.Melt {...props}>
    <slot />
    <Fragment set:html={createStylesheetHTML({
        placement, multilinePlacement, gap, direction,
    }, flexUUID)}/>
    <style is:global>
        @import "./flex.css";
    </style>
</Layout.Melt>
