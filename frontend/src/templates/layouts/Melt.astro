---
import { Window, type Element as HappyElement } from "happy-dom";
import _ from "lodash";


export interface Props {
    melt?: boolean;
}

const { melt, ...attributes } = Astro.props;

const setAttributes = (
    element: HappyElement,
    attrs: Record<string, unknown>,
) => {
    _.forEach(attrs, (value, key) => {
        element.setAttribute(key, value as any);
    });
};

const document = new new Window().Document();
const root = document.createElement('div');
const htmlToMelt = await Astro.slots.render("default");
console.log("before", root.innerHTML);
root.innerHTML = htmlToMelt;
console.log("after", root.innerHTML);

let html = "";
if (melt) {
    const firstElem = root.firstElementChild;
    firstElem && setAttributes(firstElem, attributes);
    html = root.innerHTML;
} else {
    setAttributes(root, attributes);
    html = root.outerHTML;
}
---

<Fragment set:html={html} />
