---
import type { ComponentProps } from "astro/types";
import type { GridProps } from "./types";
import { createStylesheetHTML } from "./utils";
import { clsx as mergeCSSClasses } from "clsx";
import Layout from "@layouts";

export type Props = GridProps & Astro.ComponentProps & ComponentProps<typeof Layout.Melt>;

const { inline, subgrid, cols, rows, gap, contentPlacement, cellsPlacement, ...props } = Astro.props;
const gridUUID = crypto.randomUUID();

Object.assign(props, {
  [gridUUID]: '',
  class: mergeCSSClasses(
    "astro-grid",
    { 
      "inline": inline,
      "subgrid": subgrid === "both",
      "row": subgrid === "col",
      "col": subgrid === "row",
    },
    props?.class
  ),
});
---

<Layout.Melt {...props}>
  <slot />
  <Fragment set:html={createStylesheetHTML({
    cols, rows, gap, contentPlacement, cellsPlacement
  }, gridUUID)} />
  <style is:global>
    @import "./grid.css";
  </style>
</Layout.Melt>

